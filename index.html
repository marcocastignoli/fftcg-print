<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFTCG Card Printer</title>
    <style>
        /* General styles */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        /* Input area styles */
        .input-section {
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
        }

        /* Card display styles */
        .page {
            width: 210mm;
            height: 297mm;
            margin: 0 auto 20px auto;
            padding: 10mm;
            box-sizing: border-box;
            border: 1px solid #ccc;
            page-break-after: always;
        }

        .card-container {
            display: grid;
            grid-template-columns: repeat(3, 62mm);
            grid-template-rows: repeat(3, 87mm);
            justify-content: center;
            line-height: 0;
            font-size: 0;
            grid-gap: 0; /* Explicitly set grid gap to 0 */
        }

        .card {
            width: 62mm;
            height: 87mm;
            display: block;
            margin: 0;
            padding: 0;
            border-right: 2px dashed #000;
            border-bottom: 2px dashed #000;
            box-sizing: border-box;
            vertical-align: top; /* Prevent vertical alignment issues */
            object-fit: fill; /* Changed from contain to fill */
        }

        /* Remove right border from every 3rd card */
        .card:nth-child(3n) {
            border-right: none;
        }

        /* Remove bottom border from last row */
        .card:nth-child(7),
        .card:nth-child(8),
        .card:nth-child(9) {
            border-bottom: none;
        }

        /* Print styles */
        @media print {
            @page {
                size: A4;
                margin: 0; /* Remove margin from @page */
            }

            body {
                margin: 0;
                padding: 0;
            }

            .page {
                width: 210mm;
                height: 297mm;
                border: none;
                margin: 0;
                padding: 0;
                /* Prevent any browser scaling */
                transform-origin: top left;
                transform: scale(1);
            }

            .input-section {
                display: none;
            }

            .card {
                width: 62mm !important;
                height: 87mm !important;
                /* Ensure images maintain exact dimensions */
                max-width: 62mm !important;
                max-height: 87mm !important;
                /* Keep the dashed borders for printing */
                border-right: 2px dashed #000 !important;
                border-bottom: 2px dashed #000 !important;
            }

            /* Keep the border removal rules for specific cards */
            .card:nth-child(3n) {
                border-right: none !important;
            }

            .card:nth-child(7),
            .card:nth-child(8),
            .card:nth-child(9) {
                border-bottom: none !important;
            }

            /* Force the grid to maintain exact dimensions */
            .card-container {
                grid-template-columns: repeat(3, 62mm) !important;
                grid-template-rows: repeat(3, 87mm) !important;
                gap: 0 !important;
                padding: 10mm !important; /* Add padding to create margin effect */
                box-sizing: border-box !important;
            }
        }
    </style>
</head>
<body>
    <div class="input-section">
        <h2>FFTCG Card Printer</h2>
        <h3>How to use</h3>
        <ol>
            <li>Create a new deck on https://ffdecks.com</li>
            <li>Use the "Export as" button to export the deck as a text file</li>
            <li>Paste the content of the exported file into the text area on this page and press "Load Cards"</li>
            <li>Preview the sheets and print them using the "Print Cards" button</li>
        </ol>
        <p>Paste your FF Decks export here</p>
        <p></p>
        <textarea id="cardInput" placeholder="Example:&#10;&#10;--Generated By FF Decks (www.ffdecks.com)--&#10;Deck Name: Chaos&#10;Created by: marcocastignoli&#10;&#10;..."></textarea>
        <br>
        <button onclick="generatePages()">Load Cards</button>
        <button onclick="window.print()">Print Cards</button>
    </div>
    <div id="pages"></div>

    <script>
        function generatePages() {
            const input = document.getElementById('cardInput').value;
            
            // New regex pattern to match the cards
            const cardPattern = /(\d+)\s+[^(]+\((\d{2}-\d{3}[HRCLSU])\)/g;
            const cards = [];

            // Parse input using regex
            let match;
            while ((match = cardPattern.exec(input)) !== null) {
                const quantity = parseInt(match[1]);
                const cardId = match[2];
                
                // Add card to array based on quantity
                for (let i = 0; i < quantity; i++) {
                    cards.push(cardId);
                }
            }

            // Clear previous pages
            const pagesContainer = document.getElementById('pages');
            pagesContainer.innerHTML = '';

            // Generate pages (9 cards per page)
            for (let i = 0; i < cards.length; i += 9) {
                const pageDiv = document.createElement('div');
                pageDiv.className = 'page';
                const cardContainer = document.createElement('div');
                cardContainer.className = 'card-container';

                // Add cards to the current page
                for (let j = i; j < Math.min(i + 9, cards.length); j++) {
                    const img = document.createElement('img');
                    img.className = 'card';
                    img.src = `https://fftcg.cdn.sewest.net/images/cards/full/${cards[j]}_it.jpg`;
                    img.alt = `Card ${cards[j]}`;
                    cardContainer.appendChild(img);
                }

                pageDiv.appendChild(cardContainer);
                pagesContainer.appendChild(pageDiv);
            }
        }
    </script>
</body>
</html>
